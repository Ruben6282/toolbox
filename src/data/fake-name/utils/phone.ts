import { rand } from "./random";
import { pick } from "./pick";
import { CountryCode } from "../country-codes";

// -----------------------------------------------------------------------------
// Dial codes for all supported countries
// -----------------------------------------------------------------------------
const countryDialCodes: Record<CountryCode, string> = {
  us: "+1",
  ca: "+1",
  uk: "+44",
  ie: "+353",
  de: "+49",
  nl: "+31",
  be: "+32",
  fr: "+33",
  es: "+34",
  it: "+39",
  se: "+46",
  no: "+47",
  dk: "+45",
  fi: "+358",
  pl: "+48",
  au: "+61",
  nz: "+64",
  in: "+91",
  za: "+27",
  br: "+55",

  // Newly added
  jp: "+81",
  mx: "+52",
  pt: "+351",
  kr: "+82",
  ru: "+7",
  cn: "+86",
};

// -----------------------------------------------------------------------------
// Helper: random N-digit number with leading zeros
// -----------------------------------------------------------------------------
const digits = (length: number) =>
  Math.floor(rand() * Math.pow(10, length))
    .toString()
    .padStart(length, "0");

// -----------------------------------------------------------------------------
// Country-specific phone formats
// -----------------------------------------------------------------------------
export const generatePhoneNumber = (country: CountryCode): string => {
  switch (country) {
    // -------------------------------------------------------------------------
    // North America
    // -------------------------------------------------------------------------
    case "us":
    case "ca": {
      return `(${digits(3)}) ${digits(3)}-${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // United Kingdom
    // Example formats: 020 #### ####, 074 ## ######, etc.
    // -------------------------------------------------------------------------
    case "uk": {
      const prefixes = ["020", "0161", "0131", "0117", "074", "075", "077", "079"];
      const prefix = pick<string>(prefixes);
      return `${prefix} ${digits(3)} ${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // Ireland
    // -------------------------------------------------------------------------
    case "ie": {
      const prefixes = ["01", "021", "061", "091", "071"];
      const prefix = pick<string>(prefixes);
      return `${prefix} ${digits(3)} ${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // Germany
    // 030 ####### or +49 162 ####### etc.
    // -------------------------------------------------------------------------
    case "de": {
      const prefixes = ["0151", "0160", "0176", "030", "040", "069"];
      const prefix = pick<string>(prefixes);
      return `${prefix} ${digits(7)}`;
    }

    // -------------------------------------------------------------------------
    // France
    // 06 ## ## ## ## mobile, 01 ## ## ## ## landline
    // -------------------------------------------------------------------------
    case "fr": {
      const prefixes = ["01", "02", "03", "04", "05", "06", "07"];
      const prefix = pick<string>(prefixes);
      return `${prefix} ${digits(2)} ${digits(2)} ${digits(2)} ${digits(2)}`;
    }

    // -------------------------------------------------------------------------
    // Netherlands
    // 06-######## mobile, 010 ####### landline
    // -------------------------------------------------------------------------
    case "nl": {
      const prefixes = ["06", "010", "020", "030", "040", "050"];
      const p = pick<string>(prefixes);
      return `${p} ${digits(7)}`;
    }

    // -------------------------------------------------------------------------
    // Belgium
    // -------------------------------------------------------------------------
    case "be": {
      const prefixes = ["047", "048", "049", "02", "03", "04", "09"];
      const p = pick<string>(prefixes);
      return `${p} ${digits(6)}`;
    }

    // -------------------------------------------------------------------------
    // Spain
    // -------------------------------------------------------------------------
    case "es": {
      const prefixes = ["6", "7", "8", "9"];
      return `${pick<string>(prefixes)}${digits(8)}`;
    }

    // -------------------------------------------------------------------------
    // Italy
    // -------------------------------------------------------------------------
    case "it": {
      const prefixes = ["320", "331", "333", "347", "350", "360", "02", "06"];
      return `${pick<string>(prefixes)} ${digits(7)}`;
    }

    // -------------------------------------------------------------------------
    // Nordics (Sweden, Norway, Denmark, Finland)
    // -------------------------------------------------------------------------
    case "se": {
      const prefixes = ["070", "072", "073", "076"];
      return `${pick<string>(prefixes)}-${digits(7)}`;
    }

    case "no": {
      return `${digits(3)} ${digits(2)} ${digits(3)}`;
    }

    case "dk": {
      return `${digits(2)} ${digits(2)} ${digits(2)} ${digits(2)}`;
    }

    case "fi": {
      return `${digits(3)}-${digits(6)}`;
    }

    // -------------------------------------------------------------------------
    // Eastern Europe (Poland)
    // -------------------------------------------------------------------------
    case "pl": {
      return `${digits(3)}-${digits(3)}-${digits(3)}`;
    }

    // -------------------------------------------------------------------------
    // Australia & New Zealand
    // -------------------------------------------------------------------------
    case "au": {
      return `04${digits(8)}`;
    }

    case "nz": {
      return `02${digits(7)}`;
    }

    // -------------------------------------------------------------------------
    // India
    // -------------------------------------------------------------------------
    case "in": {
      return `+91 ${digits(5)} ${digits(5)}`;
    }

    // -------------------------------------------------------------------------
    // South Africa
    // -------------------------------------------------------------------------
    case "za": {
      const prefixes = ["060", "061", "071", "072", "073", "074", "082", "083"];
      return `${pick<string>(prefixes)} ${digits(7)}`;
    }

    // -------------------------------------------------------------------------
    // Brazil
    // Format: +55 (11) 9####-#### 
    // -------------------------------------------------------------------------
    case "br": {
      const ddds = ["11", "21", "31", "41", "51"];
      return `+55 (${pick<string>(ddds)}) 9${digits(4)}-${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // Japan
    // 090-####-####
    // -------------------------------------------------------------------------
    case "jp": {
      const prefixes = ["070", "080", "090"];
      return `${pick<string>(prefixes)}-${digits(4)}-${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // Mexico
    // +52 55 #### ####
    // -------------------------------------------------------------------------
    case "mx": {
      return `+52 55 ${digits(4)} ${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // Portugal
    // 91#, 92#, 93#, 96#
    // -------------------------------------------------------------------------
    case "pt": {
      const prefixes = ["91", "92", "93", "96"];
      return `${pick<string>(prefixes)}${digits(7)}`;
    }

    // -------------------------------------------------------------------------
    // South Korea
    // 010-####-####
    // -------------------------------------------------------------------------
    case "kr": {
      return `010-${digits(4)}-${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // Russia
    // +7 9## ### ####
    // -------------------------------------------------------------------------
    case "ru": {
      return `+7 9${digits(2)} ${digits(3)} ${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // China
    // +86 1## #### ####
    // -------------------------------------------------------------------------
    case "cn": {
      return `+86 1${digits(2)} ${digits(4)} ${digits(4)}`;
    }

    // -------------------------------------------------------------------------
    // Fallback (should never happen)
    // -------------------------------------------------------------------------
    default:
      return `${countryDialCodes[country]} ${digits(9)}`;
  }
};
